<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Pop Match - ‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        /* --- New Child-Friendly Color Theme --- */
        :root {
            --color-primary: #FF4081; /* Pink/Fuchsia (‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≥‡πÇ‡∏û‡∏á/Next) */
            --color-secondary: #4DD0E1; /* Light Cyan (‡∏Ç‡∏≠‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) */
            --color-correct: #8BC34A; /* Lime Green */
            --color-wrong: #FF7043; /* Vivid Orange */
            --color-bg: #E0F7FA; /* Very Light Cyan (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á) */
            --color-card: #FFFFFF; /* White (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Header/‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) */
            --color-button-bg: #FFFDE7; /* Creamy Yellow (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) */
            --color-text-dark: #333333;
            --color-text-light: #FFFFFF;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text-dark);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center; 
            min-height: 100vh;
            text-align: center;
        }

        .container {
            width: 100%;
            max-width: 500px; 
            box-sizing: border-box;
            background-color: var(--color-card);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 0;
        }

        header {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            padding: 1.5rem 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        header h1 {
            font-size: 1.8rem;
            margin: 0;
        }

        .screen {
            padding: 1rem;
            display: none; 
            flex-grow: 1;
            flex-direction: column;
            justify-content: space-between;
        }
        .screen.active {
            display: flex;
        }

        /* --- Level Selection Screen --- */
        #level-select-screen .level-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 1rem 0;
        }
        .level-btn {
            background-color: var(--color-primary); 
            color: var(--color-text-light);
            border: none;
            padding: 1.5rem 0.5rem;
            border-radius: 12px;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #D81B60; 
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .level-btn-title {
            font-size: 0.8rem;
            font-weight: 400;
            display: block;
            margin-top: 5px;
        }

        /* --- Game Screen --- */
        #game-screen .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #C2185B; 
        }

        /* Prompt Area (Speaker Button ONLY) */
        #prompt-area {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
            min-height: 150px; 
        }
        #audio-button {
            background-color: var(--color-primary); 
            border: none;
            border-radius: 50%;
            width: 120px; 
            height: 120px; 
            font-size: 4em; 
            cursor: pointer;
            box-shadow: 0 6px 0 #D81B60; 
            transition: transform 0.1s ease;
            color: var(--color-text-light); 
        }
        
        /* Choices Area (4-button Grid) */
        #options-area {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 15px;
            flex-grow: 1; 
            padding-bottom: 1rem;
            max-width: 400px; 
            margin: 0 auto; 
            width: 100%; 
        }
        .option-btn {
            background-color: var(--color-button-bg);
            border: 5px solid var(--color-secondary); 
            border-radius: 15px; 
            padding: 10px;
            cursor: pointer;
            aspect-ratio: 1 / 1; 
            box-sizing: border-box;
            
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .option-btn .item-word {
            font-size: 2em; 
            font-weight: 900;
            color: var(--color-text-dark);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .option-btn.correct {
            border-color: var(--color-correct) !important; 
            box-shadow: 0 0 20px #8BC34A; 
            transform: scale(1.05);
            background-color: #F1F8E9; 
        }
        .option-btn.incorrect {
            border-color: var(--color-wrong) !important; 
            animation: shake 0.5s;
            background-color: #FFEBEE; 
        }

        /* Footer (1. ‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) */
        #game-footer {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #ECEFF1;
            flex-shrink: 0; 
        }
        #next-btn {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            border: none;
            width: 100%;
            padding: 1rem; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏¥‡∏° */
            border-radius: 50px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏¥‡∏° */
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #D81B60; /* ‡∏™‡∏µ‡πÄ‡∏á‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ò‡∏µ‡∏° */
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Word Pop Match</h1>
        </header>

        <div id="level-select-screen" class="screen active">
            <h2>üéâ ‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</h2>
            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô:</p>
            <div class="level-grid" id="level-grid">
                </div>
            <p style="padding-top: 2rem; color:#9E9E9E;">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á 10 Levels</p>
        </div>

        <div id="game-screen" class="screen">
            <div class="top-content">
                <div class="status-bar">
                    <span id="level-title"></span>
                    <span id="q-count">‡∏Ç‡πâ‡∏≠: 0/10</span>
                    <span id="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</span>
                </div>

                <div id="prompt-area">
                    <button id="audio-button" aria-label="Listen to the word">
                        <span class="speaker-icon">üîä</span>
                    </button>
                    <div id="feedback-message" style="margin-top:10px; font-weight:bold; color:var(--color-text-dark);"></div>
                </div>

                <div id="options-area">
                    </div>
            </div>

            <div id="game-footer">
                <button id="next-btn" disabled>‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
            </div>
        </div>
    </div>
    
    <div id="word-prompt-text" style="display: none;"></div>

    <script>
        /* ------------------- JavaScript Core Logic (‡πÉ‡∏ä‡πâ TTS) ------------------- */

        // --- DATA (2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á) ---
        // 3. ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥ 2-3 ‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á
        const ALL_LEVEL_WORDS = [
            // LEVEL 1: CVC Rhymes (‡∏™‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢)
            { level: 1, title: "‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏£‡∏∞‡∏™‡∏±‡πâ‡∏ô (Rhyme)", questions: [
                { word: "red", correct: "red", options: ["bed", "fed", "red", "lid"] },
                { word: "cat", correct: "cat", options: ["cut", "hat", "cat", "get"] },
                { word: "sun", correct: "sun", options: ["son", "run", "fun", "sun"] },
                { word: "pig", correct: "pig", options: ["peg", "big", "pig", "bag"] },
                { word: "fox", correct: "fox", options: ["box", "fix", "fax", "fox"] },
                { word: "mop", correct: "mop", options: ["map", "top", "mop", "mad"] },
                { word: "ten", correct: "ten", options: ["tin", "pin", "men", "ten"] },
                { word: "jug", correct: "jug", options: ["jog", "bug", "jug", "bog"] },
                { word: "lip", correct: "lip", options: ["lap", "lip", "lep", "sip"] },
                { word: "van", correct: "van", options: ["vet", "vim", "fan", "van"] },
            ]},
            // LEVEL 2: Two-Letter Vowels & Rhymes
            { level: 2, title: "‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏£‡∏∞‡∏Ñ‡∏π‡πà", questions: [
                { word: "boat", correct: "boat", options: ["boot", "goat", "boat", "bite"] },
                { word: "book", correct: "book", options: ["look", "cook", "hook", "book"] },
                { word: "rain", correct: "rain", options: ["train", "ran", "rein", "rain"] },
                { word: "door", correct: "door", options: ["draw", "deer", "door", "dirt"] },
                { word: "tree", correct: "tree", options: ["three", "try", "free", "tree"] },
                { word: "mouse", correct: "mouse", options: ["moose", "house", "mouth", "mouse"] },
                { word: "car", correct: "car", options: ["far", "core", "car", "crow"] },
                { word: "boy", correct: "boy", options: ["buy", "toy", "bay", "boy"] },
                { word: "eye", correct: "eye", options: ["i", "high", "eye", "eat"] },
                { word: "cow", correct: "cow", options: ["now", "wow", "can", "cow"] },
            ]},
            // LEVEL 3: Two-Syllable Animals/Objects
            { level: 3, title: "‡∏Ñ‡∏≥‡∏™‡∏≠‡∏á‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå (‡∏á‡πà‡∏≤‡∏¢)", questions: [
                { word: "tiger", correct: "tiger", options: ["tire", "tighter", "tiger", "tie"] },
                { word: "zebra", correct: "zebra", options: ["zero", "zipper", "zebra", "zip"] },
                { word: "happy", correct: "happy", options: ["hoppy", "hip", "happy", "help"] },
                { word: "table", correct: "table", options: ["tailor", "stable", "label", "table"] },
                { word: "flower", correct: "flower", options: ["flour", "flow", "foul", "flower"] },
                { word: "water", correct: "water", options: ["waiter", "wetter", "water", "whiter"] },
                { word: "yellow", correct: "yellow", options: ["yell", "yolo", "follow", "yellow"] },
                { word: "listen", correct: "listen", options: ["lessen", "lisp", "lesson", "listen"] },
                { word: "open", correct: "open", options: ["hope", "oats", "often", "open"] },
                { word: "summer", correct: "summer", options: ["suffer", "sum", "sub", "summer"] },
            ]},
            // LEVEL 4: Two-Syllable Verbs/Adjectives
            { level: 4, title: "‡∏Ñ‡∏≥‡∏™‡∏≠‡∏á‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå (‡∏Å‡∏£‡∏¥‡∏¢‡∏≤/‡∏Ñ‡∏∏‡∏ì‡∏®‡∏±‡∏û‡∏ó‡πå)", questions: [
                { word: "forget", correct: "forget", options: ["forgive", "forgo", "forget", "figure"] },
                { word: "finish", correct: "finish", options: ["fist", "funnel", "fine", "finish"] },
                { word: "sleepy", correct: "sleepy", options: ["slippy", "sleeve", "sleep", "sleepy"] },
                { word: "easy", correct: "easy", options: ["icey", "esay", "eat", "easy"] },
                { word: "hungry", correct: "hungry", options: ["anger", "hunker", "hungry", "hairy"] },
                { word: "pencil", correct: "pencil", options: ["pen", "pimple", "pestle", "pencil"] },
                { word: "cookie", correct: "cookie", options: ["cuckoo", "cooky", "cookie", "kicker"] },
                { word: "behind", correct: "behind", options: ["behave", "bound", "bend", "behind"] },
                { word: "today", correct: "today", options: ["tonight", "twoday", "toad", "today"] },
                { word: "ready", correct: "ready", options: ["read", "ruddy", "ray", "ready"] },
            ]},
            // LEVEL 5: Three-Syllable (Longer Nouns)
            { level: 5, title: "‡∏Ñ‡∏≥‡∏™‡∏≤‡∏°‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå (‡∏ô‡∏≤‡∏°)", questions: [
                { word: "banana", correct: "banana", options: ["manana", "bandana", "bonanza", "banana"] },
                { word: "computer", correct: "computer", options: ["compare", "compete", "commute", "computer"] },
                { word: "umbrella", correct: "umbrella", options: ["humble", "number", "unreal", "umbrella"] },
                { word: "elephant", correct: "elephant", options: ["elegant", "aloe", "elphant", "elephant"] },
                { word: "tomorrow", correct: "tomorrow", options: ["toma", "tomorrow", "tummy", "tomorrow"] },
                { word: "hospital", correct: "hospital", options: ["hostel", "hope", "hostess", "hospital"] },
                { word: "vacation", correct: "vacation", options: ["vocation", "vision", "vector", "vacation"] },
                { word: "exercise", correct: "exercise", options: ["extra", "exit", "exact", "exercise"] },
                { word: "mystery", correct: "mystery", options: ["mistake", "missing", "muster", "mystery"] },
                { word: "library", correct: "library", options: ["lightly", "labour", "liar", "library"] },
            ]},
            // LEVEL 6: Three-Syllable (Advanced Verbs/Concepts)
            { level: 6, title: "‡∏Ñ‡∏≥‡∏™‡∏≤‡∏°‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå (‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô)", questions: [
                { word: "remember", correct: "remember", options: ["member", "reborn", "remover", "remember"] },
                { word: "delicious", correct: "delicious", options: ["delight", "decisive", "delete", "delicious"] },
                { word: "important", correct: "important", options: ["impact", "implant", "impatient", "important"] },
                { word: "introduce", correct: "introduce", options: ["intro", "indoor", "interest", "introduce"] },
                { word: "adventure", correct: "adventure", options: ["advance", "advisor", "advent", "adventure"] },
                { word: "together", correct: "together", options: ["tougher", "toga", "tender", "together"] },
                { word: "director", correct: "director", options: ["detective", "direct", "dollar", "director"] },
                { word: "wonderful", correct: "wonderful", options: ["wonder", "waterfall", "wind", "wonderful"] },
                { word: "beautiful", correct: "beautiful", options: ["bootiful", "beauty", "butter", "beautiful"] },
                { word: "tomorrow", correct: "tomorrow", options: ["today", "tonight", "tomb", "tomorrow"] },
            ]},
            // LEVEL 7-10 ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥ 3 ‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢
            { level: 7, title: "‡∏Ñ‡∏≥‡∏™‡∏µ‡πà‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå", questions: [
                { word: "information", correct: "information", options: ["infirmary", "inflation", "informal", "information"] },
                { word: "apology", correct: "apology", options: ["apply", "apple", "apocalypse", "apology"] },
                { word: "necessary", correct: "necessary", options: ["nestle", "nerve", "new", "necessary"] },
                { word: "photography", correct: "photography", options: ["photo", "phobia", "fog", "photography"] },
                { word: "university", correct: "university", options: ["universe", "uniform", "universal", "university"] },
                { word: "vocabulary", correct: "vocabulary", options: ["voice", "vocal", "vacation", "vocabulary"] },
                { word: "celebration", correct: "celebration", options: ["sell", "select", "cell", "celebration"] },
                { word: "difficulty", correct: "difficulty", options: ["differ", "digital", "duck", "difficulty"] },
                { word: "imagination", correct: "imagination", options: ["image", "magic", "nation", "imagination"] },
                { word: "temperature", correct: "temperature", options: ["tempo", "tent", "tempt", "temperature"] },
            ]},
            { level: 8, title: "‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ -tion", questions: [
                { word: "station", correct: "station", options: ["state", "stay", "stun", "station"] },
                { word: "nation", correct: "nation", options: ["native", "nature", "notion", "nation"] },
                { word: "action", correct: "action", options: ["act", "axe", "active", "action"] },
                { word: "question", correct: "question", options: ["quest", "queue", "quiet", "question"] },
                { word: "condition", correct: "condition", options: ["concede", "connect", "contest", "condition"] },
                { word: "solution", correct: "solution", options: ["solve", "sole", "salute", "solution"] },
                { word: "operation", correct: "operation", options: ["open", "opine", "option", "operation"] },
                { word: "creation", correct: "creation", options: ["create", "creator", "credit", "creation"] },
                { word: "direction", correct: "direction", options: ["direct", "dig", "dinner", "direction"] },
                { word: "information", correct: "information", options: ["informal", "infamous", "infection", "information"] },
            ]},
            { level: 9, title: "‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ -ly / -ing", questions: [
                { word: "finally", correct: "finally", options: ["final", "fine", "funny", "finally"] },
                { word: "usually", correct: "usually", options: ["usefully", "useful", "user", "usually"] },
                { word: "clearly", correct: "clearly", options: ["cleanly", "clear", "clay", "clearly"] },
                { word: "running", correct: "running", options: ["run", "rang", "renting", "running"] },
                { word: "talking", correct: "talking", options: ["walk", "tall", "tack", "talking"] },
                { word: "driving", correct: "driving", options: ["driver", "driven", "drive", "driving"] },
                { word: "quickly", correct: "quickly", options: ["quick", "quietly", "quit", "quickly"] },
                { word: "perfectly", correct: "perfectly", options: ["perfect", "party", "partially", "perfectly"] },
                { word: "swimming", correct: "swimming", options: ["swing", "slim", "sum", "swimming"] },
                { word: "reading", correct: "reading", options: ["red", "ready", "ridden", "reading"] },
            ]},
            { level: 10, title: "‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡∏¢‡∏≤‡∏ß)", questions: [
                { word: "organization", correct: "organization", options: ["organ", "orient", "original", "organization"] },
                { word: "technology", correct: "technology", options: ["technical", "tek", "tailor", "technology"] },
                { word: "responsibility", correct: "responsibility", options: ["respond", "repose", "rest", "responsibility"] },
                { word: "experiment", correct: "experiment", options: ["experience", "expert", "express", "experiment"] },
                { word: "communication", correct: "communication", options: ["common", "comment", "community", "communication"] },
                { word: "independent", correct: "independent", options: ["dependant", "indoor", "index", "independent"] },
                { word: "relationship", correct: "relationship", options: ["relation", "ship", "sleep", "relationship"] },
                { word: "international", correct: "international", options: ["interact", "internal", "nation", "international"] },
                { word: "understanding", correct: "understanding", options: ["under", "stand", "undertake", "understanding"] },
                { word: "environment", correct: "environment", options: ["envision", "invite", "invent", "environment"] },
            ]},
        ];

        const OPTIONS_COUNT = 4;
        const MAX_REPLAY_COUNT = 3; 

        // --- ELEMENTS & TTS SETUP ---
        const levelSelectScreen = document.getElementById('level-select-screen');
        const gameScreen = document.getElementById('game-screen');
        const levelGridEl = document.getElementById('level-grid');
        const levelTitleEl = document.getElementById('level-title');
        const qCountEl = document.getElementById('q-count');
        const scoreEl = document.getElementById('score');
        const audioButton = document.getElementById('audio-button');
        const feedbackMessageEl = document.getElementById('feedback-message');
        const optionsArea = document.getElementById('options-area');
        const nextBtn = document.getElementById('next-btn');

        // TTS Variables
        const synth = window.speechSynthesis;
        let voice = null; 
        let isSpeaking = false;


        // --- GAME STATE ---
        let currentLevelData = null;
        let currentQuizIndex = 0; 
        let score = 0;
        let isAnswered = false;
        let currentWord = {}; 
        let audioPlayCount = 0; 

        // --- TTS FUNCTIONS ---

        function initTTS() {
            if (voice) return;

            const voices = synth.getVoices();
            // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏´‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÅ‡∏ö‡∏ö US
            voice = voices.find(v => v.lang === 'en-US' || v.lang.startsWith('en-')); 
            
            if (!voice && voices.length > 0) {
                 voice = voices[0];
            }
            if (!voice) {
                 console.error("No compatible voice found for TTS.");
            }
        }
        
        function speakWord(word) {
            if (!synth || !word || isSpeaking) return;
            
            synth.cancel(); 
            
            const utterance = new SpeechSynthesisUtterance(word); 
            utterance.lang = 'en-US'; // ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
            utterance.rate = 0.9; 
            utterance.voice = voice;
            
            utterance.onstart = () => { isSpeaking = true; audioButton.disabled = true; };
            utterance.onend = () => { 
                isSpeaking = false; 
                if (!isAnswered && audioPlayCount < MAX_REPLAY_COUNT) {
                    audioButton.disabled = false;
                }
            };
            
            synth.speak(utterance);
        }

        function speakFeedback(message) {
            if (!synth || !message) return;
            
            synth.cancel();
            const utterance = new SpeechSynthesisUtterance(message);
            utterance.lang = 'en-US'; 
            utterance.rate = 1.0; 
            utterance.voice = voice;
            synth.speak(utterance);
        }
        
        // --- AUDIO CONTROL LOGIC (TTS) ---

        function tryAutoPlayTTS() {
            if (isAnswered) return;
            
            // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å‡πÉ‡∏´‡πâ TTS
            speakWord(currentWord.word.toLowerCase()); 
            audioPlayCount = 1; 
            updateAudioButtonState();
        }
        
        function playWordAudioByUserClickTTS() {
            if (isAnswered || isSpeaking) return;
            
            if (audioPlayCount < MAX_REPLAY_COUNT) {
                // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å‡πÉ‡∏´‡πâ TTS
                speakWord(currentWord.word.toLowerCase()); 
                audioPlayCount++;
                updateAudioButtonState();
            }
        }
        
        function updateAudioButtonState() {
            if (isAnswered || isSpeaking) {
                 audioButton.disabled = true;
                 return;
            }
            
            if (audioPlayCount >= MAX_REPLAY_COUNT) {
                audioButton.disabled = true;
                feedbackMessageEl.textContent = '‡∏´‡∏°‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡πâ‡∏ß';
                feedbackMessageEl.style.color = 'var(--color-wrong)';
            } else {
                audioButton.disabled = false;
                const remaining = MAX_REPLAY_COUNT - audioPlayCount;

                if (audioPlayCount === 0) {
                    feedbackMessageEl.textContent = `üîä ‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡∏•‡∏≥‡πÇ‡∏û‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå (‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å ${MAX_REPLAY_COUNT} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)`;
                } else if (remaining > 0) {
                    feedbackMessageEl.textContent = `üîä ‡∏ü‡∏±‡∏á‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å ${remaining} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
                } else {
                    feedbackMessageEl.textContent = `üîä ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ!`;
                }
            }
        }


        // --- GAME LOGIC ---

        function createLevelButtons() {
            levelGridEl.innerHTML = '';
            
            ALL_LEVEL_WORDS.forEach(data => {
                const btn = document.createElement('button');
                btn.className = 'level-btn';
                btn.textContent = `Level ${data.level}`;
                
                const titleSpan = document.createElement('span');
                titleSpan.className = 'level-btn-title';
                titleSpan.textContent = data.title;
                
                btn.appendChild(titleSpan);
                btn.setAttribute('data-level', data.level);
                
                btn.addEventListener('click', () => {
                    startLevel(data.level);
                });
                levelGridEl.appendChild(btn);
            });
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(id).classList.add('active');
        }


        function updateStatusBar() {
            if (currentLevelData) {
                levelTitleEl.textContent = `${currentLevelData.title} (Level ${currentLevelData.level})`;
                qCountEl.textContent = `‡∏Ç‡πâ‡∏≠: ${currentQuizIndex + 1}/${currentLevelData.questions.length}`;
            }
            scoreEl.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
        }


        function startLevel(levelId) {
            currentLevelData = ALL_LEVEL_WORDS.find(data => data.level === levelId);
            currentQuizIndex = 0;
            score = 0; 
            showScreen('game-screen'); 
            nextQuestion();
        }

        function nextQuestion() {
            if (currentQuizIndex >= currentLevelData.questions.length) {
                endGame();
                return;
            }
            
            isAnswered = false;
            audioPlayCount = 0; 
            
            nextBtn.textContent = '‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
            nextBtn.disabled = true;
            feedbackMessageEl.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå...';
            feedbackMessageEl.style.color = 'var(--color-text-dark)';

            optionsArea.innerHTML = ''; 
            
            updateStatusBar();
            setupQuestion();
        }

        function getGameOptions() {
            const currentQuestion = currentLevelData.questions[currentQuizIndex]; 
            currentWord = currentQuestion;
            
            // ‡∏™‡∏∏‡πà‡∏° shuffle ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏°‡∏≤
            const options = currentQuestion.options.map(word => ({ word: word, isCorrect: word === currentQuestion.correct }));
            
            return options.sort(() => Math.random() - 0.5); 
        }


        function setupQuestion() {
            const options = getGameOptions();
            
            // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            options.forEach(item => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.dataset.word = item.word;
                button.dataset.isCorrect = item.isCorrect;
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà
                button.innerHTML = `
                    <span class="item-word">${item.word.toUpperCase()}</span>
                `;
                button.addEventListener('click', handleAnswer);
                optionsArea.appendChild(button);
            });
            
            // 2. ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏à‡∏∞‡πÉ‡∏ä‡πâ currentWord.word.toLowerCase())
            tryAutoPlayTTS();
            
            // 3. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 
            updateAudioButtonState(); 
        }

        function handleAnswer(event) {
            if (isAnswered) return;
            isAnswered = true;
            
            const selectedButton = event.currentTarget;
            const isCorrect = selectedButton.dataset.isCorrect === 'true';

            synth.cancel(); 
            audioButton.disabled = true;

            // 1. Disable all choices
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.removeEventListener('click', handleAnswer);
                btn.disabled = true;
            });

            // 2. Feedback
            if (isCorrect) {
                score++;
                selectedButton.classList.add('correct');
                feedbackMessageEl.textContent = `‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!`;
                feedbackMessageEl.style.color = 'var(--color-correct)';
                speakFeedback("Correct!");
            } else {
                selectedButton.classList.add('incorrect');
                // ‡πÉ‡∏ä‡πâ currentWord.correct.toUpperCase() ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                feedbackMessageEl.textContent = `‚ùå ‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ ${currentWord.correct.toUpperCase()}`;
                feedbackMessageEl.style.color = 'var(--color-wrong)';
                speakFeedback("Incorrect!");
                
                // Highlight the correct answer
                const correctAnswerButton = document.querySelector(`.option-btn[data-is-correct="true"]`);
                if (correctAnswerButton) {
                    correctAnswerButton.classList.add('correct');
                }
            }
            
            // 3. Update status and enable next button
            updateStatusBar();
            nextBtn.disabled = false;
        }


        function endGame() {
            levelTitleEl.textContent = `‡∏à‡∏ö Level ${currentLevelData.level}!`;
            qCountEl.textContent = '';
            
            const totalQuestions = currentLevelData.questions.length;
            feedbackMessageEl.innerHTML = `
                <span style="font-size:2rem; font-weight:900; color:var(--color-primary);">
                    ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ ${score}/${totalQuestions} ‡∏Ç‡πâ‡∏≠
                </span>
            `;
            feedbackMessageEl.style.color = 'var(--color-primary)';
            
            optionsArea.innerHTML = ''; 
            
            nextBtn.textContent = '‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å';
            nextBtn.disabled = false;
        }

        // --- EVENT LISTENERS ---
        
        audioButton.addEventListener('click', () => {
             playWordAudioByUserClickTTS();
        });

        nextBtn.addEventListener('click', () => {
            synth.cancel(); 
            if (currentQuizIndex >= currentLevelData.questions.length - 1 && nextBtn.textContent === '‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å') { 
                showScreen('level-select-screen');
                currentQuizIndex = 0; 
                return;
            }
            
            currentQuizIndex++;
            nextQuestion();
            
        });


        // --- INITIAL SETUP ---
        document.addEventListener('DOMContentLoaded', () => {
            createLevelButtons();
            showScreen('level-select-screen');
            
            if (synth && synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = initTTS;
            } else if (synth) {
                initTTS();
            }
        });
    </script>
</body>
</html>
