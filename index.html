<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Pop Match - ‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        /* --- Base Theme (Start Theme: Pink/Cyan) --- */
        :root {
            --color-primary: #FF4081; /* Pink */
            --color-secondary: #4DD0E1; /* Light Cyan */
            --color-correct: #8BC34A; /* Lime Green */
            --color-wrong: #FF7043; /* Vivid Orange */
            --color-bg: #E0F7FA; /* Very Light Cyan */
            --color-card: #FFFFFF;
            --color-button-bg: #FFFDE7; /* Creamy Yellow */
            --color-text-dark: #333333;
            --color-text-light: #FFFFFF;
        }
        
        /* CSS ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text-dark);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center; 
            min-height: 100vh;
            text-align: center;
        }

        .container {
            width: 100%;
            max-width: 500px; 
            box-sizing: border-box;
            background-color: var(--color-card);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 0;
        }

        header {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            padding: 1.5rem 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        header h1 {
            font-size: 1.8rem;
            margin: 0;
        }

        .screen {
            padding: 1rem;
            display: none; 
            flex-grow: 1;
            flex-direction: column;
            justify-content: space-between;
        }
        .screen.active {
            display: flex;
        }

        /* --- Level Selection Screen --- */
        #level-select-screen .level-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 1rem 0;
        }
        .level-btn {
            color: var(--color-text-light);
            border: none;
            padding: 1.5rem 0.5rem;
            border-radius: 12px;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .level-btn-title {
            font-size: 0.8rem;
            font-weight: 400;
            display: block;
            margin-top: 5px;
        }

        /* --- Game Screen --- */
        #game-screen .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #C2185B; 
        }

        #prompt-area {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
            min-height: 150px; 
        }
        #audio-button {
            background-color: var(--color-primary); 
            border: none;
            border-radius: 50%;
            width: 120px; 
            height: 120px; 
            font-size: 4em; 
            cursor: pointer;
            box-shadow: 0 6px 0 #D81B60; 
            transition: transform 0.1s ease;
            color: var(--color-text-light); 
        }
        
        /* Choices Area (4-button Grid) */
        #options-area {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 15px;
            flex-grow: 1; 
            padding-bottom: 1rem;
            max-width: 400px; 
            margin: 0 auto; 
            width: 100%; 
        }
        .option-btn {
            background-color: var(--color-button-bg);
            border: 5px solid var(--color-secondary); 
            border-radius: 15px; 
            padding: 10px;
            cursor: pointer;
            aspect-ratio: 1 / 1; 
            box-sizing: border-box;
            
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .option-btn .item-word {
            font-size: 2em; 
            font-weight: 900;
            color: var(--color-text-dark);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏ö (‡πÅ‡∏°‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÅ‡∏•‡πâ‡∏ß) */
            word-break: break-all;
            line-height: 1.1; 
        }

        .option-btn.correct {
            border-color: var(--color-correct) !important; 
            box-shadow: 0 0 20px #8BC34A; 
            transform: scale(1.05);
            background-color: #F1F8E9; 
        }
        .option-btn.incorrect {
            border-color: var(--color-wrong) !important; 
            animation: shake 0.5s;
            background-color: #FFEBEE; 
        }

        /* Footer (‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°) */
        #game-footer {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #ECEFF1;
            flex-shrink: 0; 
        }
        #next-btn {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            border: none;
            width: 100%;
            padding: 1rem; 
            border-radius: 50px; 
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #D81B60; 
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Word Pop Match</h1>
        </header>

        <div id="level-select-screen" class="screen active">
            <h2>üéâ ‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</h2>
            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô:</p>
            <div class="level-grid" id="level-grid">
                </div>
            <p style="padding-top: 2rem; color:#9E9E9E;">‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 20 Levels x 10 ‡∏Ñ‡∏≥</p>
        </div>

        <div id="game-screen" class="screen">
            <div class="top-content">
                <div class="status-bar">
                    <span id="level-title"></span>
                    <span id="q-count">‡∏Ç‡πâ‡∏≠: 0/10</span>
                    <span id="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</span>
                </div>

                <div id="prompt-area">
                    <button id="audio-button" aria-label="Listen to the word">
                        <span class="speaker-icon">üîä</span>
                    </button>
                    <div id="feedback-message" style="margin-top:10px; font-weight:bold; color:var(--color-text-dark);"></div>
                </div>

                <div id="options-area">
                    </div>
            </div>

            <div id="game-footer">
                <button id="next-btn" disabled>‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
            </div>
        </div>
    </div>
    
    <div id="word-prompt-text" style="display: none;"></div>

    <script>
        /* ------------------- JavaScript Core Logic (‡πÉ‡∏ä‡πâ TTS) ------------------- */

        // --- THEMES & CONFIG ---
        const COLOR_THEMES = [
            { primary: '#FF4081', dark: '#D81B60' }, // Pink
            { primary: '#673AB7', dark: '#5E35B1' }, // Deep Purple
            { primary: '#00BCD4', dark: '#0097A7' }, // Cyan
            { primary: '#FF9800', dark: '#F57C00' }, // Orange
            { primary: '#4CAF50', dark: '#388E3C' }  // Green
        ];
        
        const OPTIONS_COUNT = 4;
        const MAX_REPLAY_COUNT = 3; 

        // --- DATA (20 Levels, Max 11 Chars, Lowercase for TTS) ---
        const ALL_LEVEL_WORDS = [
            // LEVEL 1: CVC Rhymes (a) - 3 Chars
            { level: 1, title: "‡∏™‡∏£‡∏∞‡∏™‡∏±‡πâ‡∏ô (a)", questions: [
                { word: "cat", correct: "cat", options: ["cut", "cot", "hat", "cat"] },
                { word: "bat", correct: "bat", options: ["bet", "bit", "but", "bat"] },
                { word: "map", correct: "map", options: ["mop", "man", "mate", "map"] },
                { word: "mad", correct: "mad", options: ["bed", "mud", "made", "mad"] },
                { word: "fan", correct: "fan", options: ["fin", "fun", "fed", "fan"] },
                { word: "can", correct: "can", options: ["con", "cut", "ken", "can"] },
                { word: "wag", correct: "wag", options: ["wig", "web", "wog", "wag"] },
                { word: "gap", correct: "gap", options: ["gab", "got", "get", "gap"] },
                { word: "jam", correct: "jam", options: ["jem", "jim", "gum", "jam"] },
                { word: "dad", correct: "dad", options: ["did", "dot", "dude", "dad"] },
            ]},
            // LEVEL 2: CVC Rhymes (e, i) - 3 Chars
            { level: 2, title: "‡∏™‡∏£‡∏∞‡∏™‡∏±‡πâ‡∏ô (e, i)", questions: [
                { word: "red", correct: "red", options: ["rad", "rid", "rod", "red"] },
                { word: "ten", correct: "ten", options: ["tin", "tan", "ton", "ten"] },
                { word: "bed", correct: "bed", options: ["bid", "bad", "bud", "bed"] },
                { word: "pin", correct: "pin", options: ["pan", "pen", "pun", "pin"] },
                { word: "big", correct: "big", options: ["bag", "bug", "beg", "big"] },
                { word: "lip", correct: "lip", options: ["lap", "lop", "lup", "lip"] },
                { word: "six", correct: "six", options: ["sax", "sex", "sux", "six"] },
                { word: "jet", correct: "jet", options: ["jot", "jig", "jag", "jet"] },
                { word: "hen", correct: "hen", options: ["han", "hon", "him", "hen"] },
                { word: "kit", correct: "kit", options: ["cat", "cot", "cut", "kit"] },
            ]},
            // LEVEL 3: CVC Rhymes (o, u) - 3 Chars
            { level: 3, title: "‡∏™‡∏£‡∏∞‡∏™‡∏±‡πâ‡∏ô (o, u)", questions: [
                { word: "fox", correct: "fox", options: ["fix", "fex", "fax", "fox"] },
                { word: "sun", correct: "sun", options: ["son", "sin", "san", "sun"] },
                { word: "box", correct: "box", options: ["back", "bix", "bush", "box"] },
                { word: "dog", correct: "dog", options: ["dig", "dag", "dug", "dog"] },
                { word: "cup", correct: "cup", options: ["cap", "cop", "kip", "cup"] },
                { word: "nut", correct: "nut", options: ["not", "nat", "net", "nut"] },
                { word: "bug", correct: "bug", options: ["bag", "big", "bog", "bug"] },
                { word: "mop", correct: "mop", options: ["map", "mip", "mup", "mop"] },
                { word: "hot", correct: "hot", options: ["hat", "hit", "hut", "hot"] },
                { word: "run", correct: "run", options: ["ran", "rin", "rock", "run"] },
            ]},
            // LEVEL 4: Short Vowels Mix - 3-4 Chars
            { level: 4, title: "‡∏™‡∏£‡∏∞‡∏™‡∏±‡πâ‡∏ô (‡∏£‡∏ß‡∏°)", questions: [
                { word: "swim", correct: "swim", options: ["swam", "swum", "slim", "swim"] },
                { word: "desk", correct: "desk", options: ["disk", "dusk", "dice", "desk"] },
                { word: "crab", correct: "crab", options: ["crap", "crib", "crop", "crab"] },
                { word: "trip", correct: "trip", options: ["trap", "top", "type", "trip"] },
                { word: "slug", correct: "slug", options: ["slab", "slop", "slim", "slug"] },
                { word: "plum", correct: "plum", options: ["plan", "plot", "plume", "plum"] },
                { word: "frog", correct: "frog", options: ["flag", "fry", "frag", "frog"] },
                { word: "dress", correct: "dress", options: ["draw", "drop", "drift", "dress"] },
                { word: "belt", correct: "belt", options: ["bill", "bolt", "bent", "belt"] },
                { word: "camp", correct: "camp", options: ["comb", "crimp", "clam", "camp"] },
            ]},
            // LEVEL 5: Consonant Blends (l-blends) - 4-5 Chars
            { level: 5, title: "‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞‡∏Ñ‡∏ß‡∏ö (L)", questions: [
                { word: "blue", correct: "blue", options: ["blow", "blew", "buy", "blue"] },
                { word: "clay", correct: "clay", options: ["clue", "clash", "class", "clay"] },
                { word: "glad", correct: "glad", options: ["glass", "gold", "grip", "glad"] },
                { word: "plan", correct: "plan", options: ["plane", "play", "plus", "plan"] },
                { word: "flea", correct: "flea", options: ["fly", "free", "flat", "flea"] },
                { word: "slip", correct: "slip", options: ["slap", "slope", "sleep", "slip"] },
                { word: "club", correct: "club", options: ["clap", "clog", "cube", "club"] },
                { word: "flute", correct: "flute", options: ["float", "fruit", "foot", "flute"] },
                { word: "glove", correct: "glove", options: ["glue", "glass", "globe", "glove"] },
                { word: "plank", correct: "plank", options: ["plane", "plan", "pinch", "plank"] },
            ]},
            // LEVEL 6: Consonant Blends (r-blends) - 4-5 Chars
            { level: 6, title: "‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞‡∏Ñ‡∏ß‡∏ö (R)", questions: [
                { word: "press", correct: "press", options: ["price", "pray", "prince", "press"] },
                { word: "trip", correct: "trip", options: ["trap", "top", "type", "trip"] },
                { word: "bring", correct: "bring", options: ["brain", "rang", "ring", "bring"] },
                { word: "drop", correct: "drop", options: ["drip", "drag", "drove", "drop"] },
                { word: "free", correct: "free", options: ["fly", "frog", "fry", "free"] },
                { word: "grape", correct: "grape", options: ["great", "grip", "grace", "grape"] },
                { word: "crib", correct: "crib", options: ["crop", "crab", "crip", "crib"] },
                { word: "frame", correct: "frame", options: ["firm", "farm", "foam", "frame"] },
                { word: "proud", correct: "proud", options: ["pride", "prize", "pound", "proud"] },
                { word: "train", correct: "train", options: ["trend", "tiny", "turn", "train"] },
            ]},
            // LEVEL 7: Digraphs (sh, ch, th) - 4-6 Chars
            { level: 7, title: "‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ñ‡∏π‡πà (Sh, Ch, Th)", questions: [
                { word: "ship", correct: "ship", options: ["sip", "chip", "shop", "ship"] },
                { word: "chair", correct: "chair", options: ["cheer", "care", "share", "chair"] },
                { word: "thumb", correct: "thumb", options: ["sum", "tub", "pump", "thumb"] },
                { word: "cash", correct: "cash", options: ["kiss", "crash", "car", "cash"] },
                { word: "peach", correct: "peach", options: ["pitch", "peak", "push", "peach"] },
                { word: "think", correct: "think", options: ["sink", "thank", "thin", "think"] },
                { word: "shop", correct: "shop", options: ["chop", "ship", "short", "shop"] },
                { word: "lunch", correct: "lunch", options: ["lunge", "latch", "long", "lunch"] },
                { word: "bath", correct: "bath", options: ["bathe", "both", "path", "bath"] },
                { word: "wheel", correct: "wheel", options: ["weel", "whale", "will", "wheel"] },
            ]},
            // LEVEL 8: Long A (a_e, ai, ay) - 4-5 Chars
            { level: 8, title: "‡∏™‡∏£‡∏∞‡∏¢‡∏≤‡∏ß (A)", questions: [
                { word: "make", correct: "make", options: ["mack", "mike", "moke", "make"] },
                { word: "rain", correct: "rain", options: ["ran", "rent", "reign", "rain"] },
                { word: "day", correct: "day", options: ["die", "dot", "due", "day"] },
                { word: "game", correct: "game", options: ["gem", "gome", "gum", "game"] },
                { word: "play", correct: "play", options: ["plea", "ploy", "pull", "play"] },
                { word: "tail", correct: "tail", options: ["tell", "tool", "tile", "tail"] },
                { word: "cake", correct: "cake", options: ["cook", "kick", "kake", "cake"] },
                { word: "bay", correct: "bay", options: ["bye", "bobby", "bee", "bay"] },
                { word: "snail", correct: "snail", options: ["snell", "snarl", "smile", "snail"] },
                { word: "plane", correct: "plane", options: ["plan", "plum", "plain", "plane"] },
            ]},
            // LEVEL 9: Long E (e_e, ee, ea) - 3-5 Chars
            { level: 9, title: "‡∏™‡∏£‡∏∞‡∏¢‡∏≤‡∏ß (E)", questions: [
                { word: "see", correct: "see", options: ["sea", "say", "so", "see"] },
                { word: "meet", correct: "meet", options: ["mate", "might", "meat", "meet"] },
                { word: "leaf", correct: "leaf", options: ["life", "lief", "loff", "leaf"] },
                { word: "green", correct: "green", options: ["grin", "grain", "great", "green"] },
                { word: "feet", correct: "feet", options: ["fit", "fat", "fought", "feet"] },
                { word: "team", correct: "team", options: ["time", "tame", "tome", "team"] },
                { word: "sleep", correct: "sleep", options: ["slip", "slope", "slap", "sleep"] },
                { word: "bee", correct: "bee", options: ["buy", "bay", "bale", "bee"] },
                { word: "tree", correct: "tree", options: ["try", "tray", "tire", "tree"] },
                { word: "read", correct: "read", options: ["rid", "rod", "road", "read"] },
            ]},
            // LEVEL 10: Long I (i_e, ie, y) - 3-5 Chars
            { level: 10, title: "‡∏™‡∏£‡∏∞‡∏¢‡∏≤‡∏ß (I)", questions: [
                { word: "bike", correct: "bike", options: ["back", "beck", "book", "bike"] },
                { word: "fly", correct: "fly", options: ["flea", "flow", "full", "fly"] },
                { word: "time", correct: "time", options: ["tame", "team", "tome", "time"] },
                { word: "pie", correct: "pie", options: ["pee", "pay", "poy", "pie"] },
                { word: "light", correct: "light", options: ["let", "late", "lout", "light"] },
                { word: "cry", correct: "cry", options: ["crow", "cray", "crew", "cry"] },
                { word: "five", correct: "five", options: ["fife", "for", "fine", "five"] },
                { word: "side", correct: "side", options: ["said", "sad", "sod", "side"] },
                { word: "sky", correct: "sky", options: ["ski", "skay", "sock", "sky"] },
                { word: "high", correct: "high", options: ["hi", "hoe", "hay", "high"] },
            ]},
            // LEVEL 11: Long O (o_e, oa, ow) - 4-5 Chars
            { level: 11, title: "‡∏™‡∏£‡∏∞‡∏¢‡∏≤‡∏ß (O)", questions: [
                { word: "nose", correct: "nose", options: ["noose", "noise", "noss", "nose"] },
                { word: "coat", correct: "coat", options: ["cut", "cot", "kit", "coat"] },
                { word: "snow", correct: "snow", options: ["snip", "snob", "sneeze", "snow"] },
                { word: "boat", correct: "boat", options: ["boot", "bought", "bite", "boat"] },
                { word: "home", correct: "home", options: ["hum", "ham", "hume", "home"] },
                { word: "road", correct: "road", options: ["red", "ride", "rod", "road"] },
                { word: "toe", correct: "toe", options: ["too", "two", "toy", "toe"] },
                { word: "slow", correct: "slow", options: ["slaw", "slot", "slept", "slow"] },
                { word: "note", correct: "note", options: ["nut", "net", "not", "note"] },
                { word: "grow", correct: "grow", options: ["gray", "grip", "gear", "grow"] },
            ]},
            // LEVEL 12: Long U (u_e, ue, oo) - 4-5 Chars
            { level: 12, title: "‡∏™‡∏£‡∏∞‡∏¢‡∏≤‡∏ß (U)", questions: [
                { word: "flute", correct: "flute", options: ["float", "foot", "flat", "flute"] },
                { word: "glue", correct: "glue", options: ["glow", "glew", "glad", "glue"] },
                { word: "moon", correct: "moon", options: ["moan", "man", "mine", "moon"] },
                { word: "blue", correct: "blue", options: ["blow", "blew", "bell", "blue"] },
                { word: "cube", correct: "cube", options: ["cub", "cab", "cop", "cube"] },
                { word: "tool", correct: "tool", options: ["tall", "tale", "toll", "tool"] },
                { word: "food", correct: "food", options: ["fed", "foot", "fade", "food"] },
                { word: "suit", correct: "suit", options: ["set", "sat", "site", "suit"] },
                { word: "mule", correct: "mule", options: ["male", "mile", "moll", "mule"] },
                { word: "pool", correct: "pool", options: ["pole", "pull", "pill", "pool"] },
            ]},
            // LEVEL 13: R-Controlled Vowels - 3-5 Chars
            { level: 13, title: "‡∏™‡∏£‡∏∞‡∏°‡∏µ R", questions: [
                { word: "car", correct: "car", options: ["care", "core", "cur", "car"] },
                { word: "form", correct: "form", options: ["firm", "farm", "foam", "form"] },
                { word: "girl", correct: "girl", options: ["gale", "gore", "gull", "girl"] },
                { word: "her", correct: "her", options: ["hair", "hear", "hire", "her"] },
                { word: "star", correct: "star", options: ["stair", "store", "stir", "star"] },
                { word: "corn", correct: "corn", options: ["coin", "curb", "core", "corn"] },
                { word: "bird", correct: "bird", options: ["beard", "bore", "bred", "bird"] },
                { word: "turn", correct: "turn", options: ["tone", "tin", "torn", "turn"] },
                { word: "park", correct: "park", options: ["perk", "pork", "pike", "park"] },
                { word: "short", correct: "short", options: ["shirt", "shut", "sort", "short"] },
            ]},
            // LEVEL 14: Two Syllables (Nouns/Objects) - 5-7 Chars
            { level: 14, title: "‡∏Ñ‡∏≥ 2 ‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå (‡∏ô‡∏≤‡∏°)", questions: [
                { word: "pencil", correct: "pencil", options: ["pen", "pimple", "pestle", "pencil"] },
                { word: "table", correct: "table", options: ["tailor", "stable", "label", "table"] },
                { word: "tiger", correct: "tiger", options: ["tire", "tighter", "tie", "tiger"] },
                { word: "flower", correct: "flower", options: ["flour", "flow", "foul", "flower"] },
                { word: "cookie", correct: "cookie", options: ["cuckoo", "cooky", "coke", "cookie"] },
                { word: "rocket", correct: "rocket", options: ["rock", "rabbit", "racket", "rocket"] },
                { word: "basket", correct: "basket", options: ["best", "bask", "biscuit", "basket"] },
                { word: "window", correct: "window", options: ["wine", "wind", "winter", "window"] },
                { word: "doctor", correct: "doctor", options: ["duck", "direct", "dot", "doctor"] },
                { word: "magnet", correct: "magnet", options: ["mag", "main", "money", "magnet"] },
            ]},
            // LEVEL 15: Two Syllables (Verbs/Adjectives) - 5-7 Chars
            { level: 15, title: "‡∏Ñ‡∏≥ 2 ‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå (‡∏Å‡∏£‡∏¥‡∏¢‡∏≤/‡∏Ñ‡∏∏‡∏ì‡∏®‡∏±‡∏û‡∏ó‡πå)", questions: [
                { word: "finish", correct: "finish", options: ["fist", "funnel", "fine", "finish"] },
                { word: "listen", correct: "listen", options: ["lessen", "lisp", "lesson", "listen"] },
                { word: "forget", correct: "forget", options: ["forgive", "forgo", "figure", "forget"] },
                { word: "hungry", correct: "hungry", options: ["anger", "hunker", "hairy", "hungry"] },
                { word: "before", correct: "before", options: ["for", "four", "bore", "before"] },
                { word: "happy", correct: "happy", options: ["hoppy", "hip", "help", "happy"] },
                { word: "ready", correct: "ready", options: ["read", "ruddy", "ray", "ready"] },
                { word: "today", correct: "today", options: ["tonight", "toad", "two", "today"] },
                { word: "open", correct: "open", options: ["hope", "oats", "often", "open"] },
                { word: "answer", correct: "answer", options: ["ant", "enter", "and", "answer"] },
            ]},
            // LEVEL 16: Three Syllables (Easy) - 6-8 Chars
            { level: 16, title: "‡∏Ñ‡∏≥ 3 ‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå (‡∏á‡πà‡∏≤‡∏¢)", questions: [
                { word: "banana", correct: "banana", options: ["manana", "bandana", "bonanza", "banana"] },
                { word: "family", correct: "family", options: ["famine", "farm", "firmly", "family"] },
                { word: "company", correct: "company", options: ["comet", "come", "comply", "company"] },
                { word: "camera", correct: "camera", options: ["camper", "car", "karma", "camera"] },
                { word: "holiday", correct: "holiday", options: ["hole", "holy", "hallway", "holiday"] },
                { word: "america", correct: "america", options: ["amuse", "merry", "murmur", "america"] },
                { word: "animal", correct: "animal", options: ["annoy", "annual", "ally", "animal"] },
                { word: "bicycle", correct: "bicycle", options: ["bike", "by", "cycle", "bicycle"] },
                { word: "pirate", correct: "pirate", options: ["parade", "private", "prior", "pirate"] },
                { word: "umbrella", correct: "umbrella", options: ["humble", "number", "unreal", "umbrella"] },
            ]},
            // LEVEL 17: Three Syllables (Medium) - 8-11 Chars
            { level: 17, title: "‡∏Ñ‡∏≥ 3 ‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå (‡∏Å‡∏•‡∏≤‡∏á)", questions: [
                { word: "difficult", correct: "difficult", options: ["dig", "digging", "daddy", "difficult"] },
                { word: "tomorrow", correct: "tomorrow", options: ["toma", "tummy", "tomb", "tomorrow"] },
                { word: "elephant", correct: "elephant", options: ["elegant", "aloe", "elphant", "elephant"] },
                { word: "yesterday", correct: "yesterday", options: ["yes", "yester", "day", "yesterday"] },
                { word: "continue", correct: "continue", options: ["content", "control", "count", "continue"] },
                { word: "together", correct: "together", options: ["tougher", "toga", "tender", "together"] },
                { word: "accident", correct: "accident", options: ["axe", "action", "access", "accident"] },
                { word: "decorate", correct: "decorate", options: ["deck", "direct", "dot", "decorate"] },
                { word: "delivery", correct: "delivery", options: ["deliver", "delay", "deal", "delivery"] },
                { word: "customer", correct: "customer", options: ["custom", "cast", "cost", "customer"] },
            ]},
            // LEVEL 18: Three Syllables (Advanced) - 8-11 Chars
            { level: 18, title: "‡∏Ñ‡∏≥ 3 ‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå (‡∏¢‡∏≤‡∏Å)", questions: [
                { word: "important", correct: "important", options: ["impact", "implant", "impatient", "important"] },
                { word: "adventure", correct: "adventure", options: ["advance", "advisor", "advent", "adventure"] },
                { word: "beautiful", correct: "beautiful", options: ["bootiful", "beauty", "butter", "beautiful"] },
                { word: "introduce", correct: "introduce", options: ["intro", "indoor", "interest", "introduce"] },
                { word: "remember", correct: "remember", options: ["member", "reborn", "remover", "remember"] },
                { word: "delicious", correct: "delicious", options: ["delight", "decisive", "delete", "delicious"] },
                { word: "wonderful", correct: "wonderful", options: ["wonder", "wind", "wave", "wonderful"] },
                { word: "surprised", correct: "surprised", options: ["sure", "supply", "side", "surprised"] },
                { word: "exciting", correct: "exciting", options: ["exit", "extra", "exact", "exciting"] },
                { word: "powerful", correct: "powerful", options: ["power", "paw", "push", "powerful"] },
            ]},
            // LEVEL 19: Four Syllables (Easy) - 8-11 Chars
            { level: 19, title: "‡∏Ñ‡∏≥ 4 ‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå (‡∏á‡πà‡∏≤‡∏¢)", questions: [
                { word: "computer", correct: "computer", options: ["compare", "compete", "commute", "computer"] },
                { word: "solution", correct: "solution", options: ["solve", "sole", "salute", "solution"] },
                { word: "apology", correct: "apology", options: ["apply", "apple", "apocalypse", "apology"] },
                { word: "necessary", correct: "necessary", options: ["nestle", "nerve", "new", "necessary"] },
                { word: "activity", correct: "activity", options: ["active", "act", "actor", "activity"] },
                { word: "discovery", correct: "discovery", options: ["disagree", "discuss", "disc", "discovery"] },
                { word: "geography", correct: "geography", options: ["geo", "graph", "grave", "geography"] },
                { word: "security", correct: "security", options: ["sure", "secret", "section", "security"] },
                { word: "celebrity", correct: "celebrity", options: ["sell", "select", "cell", "celebrity"] },
                { word: "education", correct: "education", options: ["edit", "echo", "eager", "education"] },
            ]},
            // LEVEL 20: Four Syllables (Harder) - 10-11 Chars
            { level: 20, title: "‡∏Ñ‡∏≥ 4 ‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå (‡∏¢‡∏≤‡∏Å)", questions: [
                { word: "vocabulary", correct: "vocabulary", options: ["voice", "vocal", "vacation", "vocabulary"] },
                { word: "experiment", correct: "experiment", options: ["experience", "expert", "express", "experiment"] },
                { word: "vegetable", correct: "vegetable", options: ["very", "vet", "visit", "vegetable"] },
                { word: "advisable", correct: "advisable", options: ["advice", "visual", "visa", "advisable"] },
                { word: "available", correct: "available", options: ["avoid", "avocado", "able", "available"] },
                { word: "community", correct: "community", options: ["common", "comment", "come", "community"] },
                { word: "deliciously", correct: "deliciously", options: ["delight", "deliberate", "delete", "deliciously"] },
                { word: "historical", correct: "historical", options: ["history", "store", "start", "historical"] },
                { word: "magical", correct: "magical", options: ["major", "magic", "manage", "magical"] },
                { word: "technology", correct: "technology", options: ["technical", "tek", "tailor", "technology"] },
            ]},
        ];

        // --- ELEMENTS & TTS SETUP ---
        const levelSelectScreen = document.getElementById('level-select-screen');
        const gameScreen = document.getElementById('game-screen');
        const levelGridEl = document.getElementById('level-grid');
        const levelTitleEl = document.getElementById('level-title');
        const qCountEl = document.getElementById('q-count');
        const scoreEl = document.getElementById('score');
        const audioButton = document.getElementById('audio-button');
        const feedbackMessageEl = document.getElementById('feedback-message');
        const optionsArea = document.getElementById('options-area');
        const nextBtn = document.getElementById('next-btn');

        // TTS Variables
        const synth = window.speechSynthesis;
        let voice = null; 
        let isSpeaking = false;


        // --- GAME STATE ---
        let currentLevelData = null;
        let currentQuizIndex = 0; 
        let score = 0;
        let isAnswered = false;
        let currentWord = {}; 
        let audioPlayCount = 0; 

        // --- TTS FUNCTIONS ---

        function initTTS() {
            if (voice) return;

            const voices = synth.getVoices();
            voice = voices.find(v => v.lang === 'en-US' || v.lang.startsWith('en-')); 
            
            if (!voice && voices.length > 0) {
                 voice = voices[0];
            }
            if (!voice) {
                 console.error("No compatible voice found for TTS.");
            }
        }
        
        function speakWord(word) {
            if (!synth || !word || isSpeaking) return;
            
            synth.cancel(); 
            
            const utterance = new SpeechSynthesisUtterance(word); 
            utterance.lang = 'en-US'; 
            utterance.rate = 0.9; 
            utterance.voice = voice;
            
            utterance.onstart = () => { isSpeaking = true; audioButton.disabled = true; };
            utterance.onend = () => { 
                isSpeaking = false; 
                if (!isAnswered && audioPlayCount < MAX_REPLAY_COUNT) {
                    audioButton.disabled = false;
                }
            };
            
            synth.speak(utterance);
        }

        function speakFeedback(message) {
            if (!synth || !message) return;
            
            synth.cancel();
            const utterance = new SpeechSynthesisUtterance(message);
            utterance.lang = 'en-US'; 
            utterance.rate = 1.0; 
            utterance.voice = voice;
            synth.speak(utterance);
        }
        
        // --- AUDIO CONTROL LOGIC (TTS) ---

        function tryAutoPlayTTS() {
            if (isAnswered) return;
            
            speakWord(currentWord.word.toLowerCase()); 
            audioPlayCount = 1; 
            updateAudioButtonState();
        }
        
        function playWordAudioByUserClickTTS() {
            if (isAnswered || isSpeaking) return;
            
            if (audioPlayCount < MAX_REPLAY_COUNT) {
                speakWord(currentWord.word.toLowerCase()); 
                audioPlayCount++;
                updateAudioButtonState();
            }
        }
        
        function updateAudioButtonState() {
            if (isAnswered || isSpeaking) {
                 audioButton.disabled = true;
                 return;
            }
            
            if (audioPlayCount >= MAX_REPLAY_COUNT) {
                audioButton.disabled = true;
                feedbackMessageEl.textContent = '‡∏´‡∏°‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡πâ‡∏ß';
                feedbackMessageEl.style.color = 'var(--color-wrong)';
            } else {
                audioButton.disabled = false;
                const remaining = MAX_REPLAY_COUNT - audioPlayCount;

                if (audioPlayCount === 0) {
                    feedbackMessageEl.textContent = `üîä ‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡∏•‡∏≥‡πÇ‡∏û‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå (‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å ${MAX_REPLAY_COUNT} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)`;
                } else if (remaining > 0) {
                    feedbackMessageEl.textContent = `üîä ‡∏ü‡∏±‡∏á‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å ${remaining} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
                } else {
                    feedbackMessageEl.textContent = `üîä ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ!`;
                }
            }
        }


        // --- GAME LOGIC ---

        function setPrimaryTheme(theme) {
            document.documentElement.style.setProperty('--color-primary', theme.primary);
            document.documentElement.style.setProperty('--color-secondary', theme.primary); // ‡πÉ‡∏ä‡πâ Primary ‡πÄ‡∏õ‡πá‡∏ô Secondary ‡∏î‡πâ‡∏ß‡∏¢
            document.documentElement.style.setProperty('--color-wrong', theme.dark);
            document.getElementById('audio-button').style.boxShadow = `0 6px 0 ${theme.dark}`;
            document.getElementById('next-btn').style.boxShadow = `0 4px 0 ${theme.dark}`;
        }
        
        function createLevelButtons() {
            levelGridEl.innerHTML = '';
            
            ALL_LEVEL_WORDS.forEach((data, index) => {
                const themeIndex = index % COLOR_THEMES.length;
                const theme = COLOR_THEMES[themeIndex];
                
                const btn = document.createElement('button');
                btn.className = 'level-btn';
                btn.textContent = `Level ${data.level}`;
                
                // ‡πÉ‡∏ä‡πâ Inline Style ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏° Level
                btn.style.backgroundColor = theme.primary;
                btn.style.boxShadow = `0 4px 0 ${theme.dark}`;
                
                const titleSpan = document.createElement('span');
                titleSpan.className = 'level-btn-title';
                titleSpan.textContent = data.title;
                
                btn.appendChild(titleSpan);
                btn.setAttribute('data-level', data.level);
                
                btn.addEventListener('click', () => {
                    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ò‡∏µ‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°‡πÄ‡∏û‡∏•‡∏¢‡πå‡∏ï‡∏≤‡∏° Level ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                    setPrimaryTheme(theme);
                    startLevel(data.level);
                });
                levelGridEl.appendChild(btn);
            });
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ò‡∏µ‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            setPrimaryTheme(COLOR_THEMES[0]);
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(id).classList.add('active');
        }


        function updateStatusBar() {
            if (currentLevelData) {
                levelTitleEl.textContent = `${currentLevelData.title} (Level ${currentLevelData.level})`;
                qCountEl.textContent = `‡∏Ç‡πâ‡∏≠: ${currentQuizIndex + 1}/${currentLevelData.questions.length}`;
            }
            scoreEl.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
        }


        function startLevel(levelId) {
            currentLevelData = ALL_LEVEL_WORDS.find(data => data.level === levelId);
            currentQuizIndex = 0;
            score = 0; 
            showScreen('game-screen'); 
            nextQuestion();
        }

        function nextQuestion() {
            if (currentQuizIndex >= currentLevelData.questions.length) {
                endGame();
                return;
            }
            
            isAnswered = false;
            audioPlayCount = 0; 
            
            nextBtn.textContent = '‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
            nextBtn.disabled = true;
            feedbackMessageEl.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå...';
            feedbackMessageEl.style.color = 'var(--color-text-dark)';

            optionsArea.innerHTML = ''; 
            
            updateStatusBar();
            setupQuestion();
        }

        function getGameOptions() {
            const currentQuestion = currentLevelData.questions[currentQuizIndex]; 
            currentWord = currentQuestion;
            
            const options = currentQuestion.options.map(word => ({ word: word, isCorrect: word === currentQuestion.correct }));
            
            return options.sort(() => Math.random() - 0.5); 
        }


        function setupQuestion() {
            const options = getGameOptions();
            
            // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            options.forEach(item => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.dataset.word = item.word;
                button.dataset.isCorrect = item.isCorrect;
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà
                button.innerHTML = `
                    <span class="item-word">${item.word.toUpperCase()}</span>
                `;
                button.addEventListener('click', handleAnswer);
                optionsArea.appendChild(button);
            });
            
            // 2. ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ 
            tryAutoPlayTTS();
            
            // 3. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 
            updateAudioButtonState(); 
        }

        function handleAnswer(event) {
            if (isAnswered) return;
            isAnswered = true;
            
            const selectedButton = event.currentTarget;
            const isCorrect = selectedButton.dataset.isCorrect === 'true';

            synth.cancel(); 
            audioButton.disabled = true;

            // 1. Disable all choices
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.removeEventListener('click', handleAnswer);
                btn.disabled = true;
            });

            // 2. Feedback
            if (isCorrect) {
                score++;
                selectedButton.classList.add('correct');
                feedbackMessageEl.textContent = `‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!`;
                feedbackMessageEl.style.color = 'var(--color-correct)';
                speakFeedback("Correct!");
            } else {
                selectedButton.classList.add('incorrect');
                feedbackMessageEl.textContent = `‚ùå ‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ ${currentWord.correct.toUpperCase()}`;
                feedbackMessageEl.style.color = 'var(--color-wrong)';
                speakFeedback("Incorrect!");
                
                const correctAnswerButton = document.querySelector(`.option-btn[data-is-correct="true"]`);
                if (correctAnswerButton) {
                    correctAnswerButton.classList.add('correct');
                }
            }
            
            // 3. Update status and enable next button
            updateStatusBar();
            nextBtn.disabled = false;
        }


        function endGame() {
            levelTitleEl.textContent = `‡∏à‡∏ö Level ${currentLevelData.level}!`;
            qCountEl.textContent = '';
            
            const totalQuestions = currentLevelData.questions.length;
            feedbackMessageEl.innerHTML = `
                <span style="font-size:2rem; font-weight:900; color:var(--color-primary);">
                    ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ ${score}/${totalQuestions} ‡∏Ç‡πâ‡∏≠
                </span>
            `;
            feedbackMessageEl.style.color = 'var(--color-primary)';
            
            optionsArea.innerHTML = ''; 
            
            nextBtn.textContent = '‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å';
            nextBtn.disabled = false;
        }

        // --- EVENT LISTENERS ---
        
        audioButton.addEventListener('click', () => {
             playWordAudioByUserClickTTS();
        });

        nextBtn.addEventListener('click', () => {
            synth.cancel(); 
            if (currentQuizIndex >= currentLevelData.questions.length - 1 && nextBtn.textContent === '‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å') { 
                showScreen('level-select-screen');
                currentQuizIndex = 0; 
                return;
            }
            
            currentQuizIndex++;
            nextQuestion();
            
        });


        // --- INITIAL SETUP ---
        document.addEventListener('DOMContentLoaded', () => {
            createLevelButtons();
            showScreen('level-select-screen');
            
            if (synth && synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = initTTS;
            } else if (synth) {
                initTTS();
            }
        });
    </script>
</body>
</html>
