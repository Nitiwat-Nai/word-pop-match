<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Pop Match - ‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        /* --- Mobile-First CSS with Original Color Theme (Purple/Pink/Teal) --- */
        :root {
            --color-primary: #9C27B0; /* Deep Purple (‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≥‡πÇ‡∏û‡∏á/Next) */
            --color-secondary: #E1BEE7; /* Light Lavender (‡∏Ç‡∏≠‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) */
            --color-correct: #00BCD4; /* Cyan/Teal (‡∏™‡∏µ‡∏ñ‡∏π‡∏Å) */
            --color-wrong: #FF5252; /* Bright Red (‡∏™‡∏µ‡∏ú‡∏¥‡∏î) */
            --color-bg: #F3E5F5; /* Very Light Purple/Pink (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á) */
            --color-card: #FFFFFF; /* White (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Header/‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) */
            --color-button-bg: #FCE4EC; /* Light Pink (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) */
            --color-text-dark: #333333;
            --color-text-light: #FFFFFF;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text-dark);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            /* **‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡πÉ‡∏ä‡πâ 100dvh ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏ñ‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (iOS/Android) */
            min-height: 100dvh; 
            text-align: center;
        }

        .container {
            width: 100%;
            /* **‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡∏õ‡∏£‡∏±‡∏ö Max-width ‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î Homophone */
            max-width: 500px; 
            box-sizing: border-box;
            background-color: var(--color-card);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            
            /* **‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡πÉ‡∏ä‡πâ 100dvh ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Homophone structure) */
            height: 100dvh;
            min-height: 100dvh;
            
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 0;
        }
        
        /* Header */
        header {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            padding: 1.5rem 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            flex-shrink: 0; 
        }
        header h1 {
            font-size: 1.8rem;
            margin: 0;
        }

        /* Screen Management */
        .screen {
            padding: 1rem;
            display: none; 
            flex-grow: 1; 
            flex-direction: column;
            justify-content: space-between;
        }
        .screen.active {
            display: flex;
        }

        /* --- Level Selection Screen --- */
        #level-select-screen .level-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 1rem 0;
        }
        .level-btn {
            background-color: #673AB7; 
            color: var(--color-text-light);
            border: none;
            padding: 1.5rem 0.5rem;
            border-radius: 12px;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #5E35B1;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .level-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #5E35B1;
        }
        .level-btn-title {
            font-size: 0.8rem;
            font-weight: 400;
            display: block;
            margin-top: 5px;
        }

        /* --- Game Screen --- */
        #game-screen {
            justify-content: flex-start;
            flex-grow: 1; 
        }
        #game-screen .top-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        #game-screen .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: #4A148C; 
        }

        /* Prompt Area (Speaker Button) */
        #prompt-area {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 2rem;
            min-height: 150px; 
        }
        #audio-button {
            background-color: var(--color-primary); 
            border: none;
            border-radius: 50%;
            width: 150px;
            height: 150px;
            font-size: 4em;
            cursor: pointer;
            box-shadow: 0 6px 0 #7B1FA2; 
            transition: transform 0.1s ease;
            color: var(--color-text-light); 
        }
        #audio-button:active {
            transform: translateY(3px); 
            box-shadow: 0 3px 0 #7B1FA2;
        }
        
        /* Choices Area (4-button Grid) */
        #options-area {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 15px;
            flex-grow: 1; 
            padding-bottom: 1rem;
        }
        .option-btn {
            background-color: var(--color-button-bg);
            border: 5px solid var(--color-secondary); 
            border-radius: 15px; 
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            aspect-ratio: 1 / 1; 
            box-sizing: border-box;
            
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            line-height: 1.2;
        }

        /* Icon (Emoji) Style */
        .option-btn .item-icon {
            font-size: 3.5em; 
            margin-bottom: 5px;
        }
        /* Word Style */
        .option-btn .item-word {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--color-text-dark);
        }

        .option-btn:hover, .option-btn:focus {
            border-color: var(--color-primary); 
        }
        
        /* Feedback Colors */
        .option-btn.correct {
            border-color: var(--color-correct) !important; 
            box-shadow: 0 0 20px #4DD0E1; 
            transform: scale(1.05);
            background-color: #E0F7FA; 
        }
        .option-btn.incorrect {
            border-color: var(--color-wrong) !important; 
            animation: shake 0.5s;
            background-color: #FFEBEE; 
        }
        @keyframes shake {
            0%, 100% {transform: translateX(0);}
            20%, 60% {transform: translateX(-5px);}
            40%, 80% {transform: translateX(5px);}
        }

        /* Footer/Control */
        #game-footer {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #ECEFF1;
            flex-shrink: 0; 
        }
        #next-btn {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            border: none;
            width: 100%;
            padding: 1rem;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #7B1FA2;
            transition: all 0.1s;
        }
        #next-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #7B1FA2;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Word Pop Match</h1>
        </header>

        <div id="level-select-screen" class="screen active">
            <h2>üéâ ‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h2>
            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô (Level ‡∏•‡∏∞ 10 ‡∏Ñ‡∏≥):</p>
            <div class="level-grid" id="level-grid">
                </div>
            <p style="padding-top: 2rem; color:#9E9E9E;">‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 10 Levels x 10 ‡∏Ñ‡∏≥ = 100 ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</p>
        </div>

        <div id="game-screen" class="screen">
            <div class="top-content">
                <div class="status-bar">
                    <span id="level-title"></span>
                    <span id="q-count">‡∏Ç‡πâ‡∏≠: 0/10</span>
                    <span id="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</span>
                </div>

                <div id="prompt-area">
                    <button id="audio-button" aria-label="Listen to the word">
                        <span class="speaker-icon">üîä</span>
                    </button>
                    <div id="feedback-message" style="margin-top:10px; font-weight:bold; color:var(--color-text-dark);"></div>
                </div>

                <div id="options-area">
                    </div>
            </div>

            <div id="game-footer">
                <button id="next-btn" disabled>‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
            </div>
        </div>
    </div>

    <audio id="word-audio"></audio>
    <audio id="correct-audio" src="sounds/correct.mp3"></audio>
    <audio id="incorrect-audio" src="sounds/incorrect.mp3"></audio>

    <script>
        /* ------------------- JavaScript Core Logic ------------------- */

        // --- DATA (10 Levels x 10 Words) ---
        const ALL_LEVEL_WORDS = [
            // LEVEL 1: Colors & Basic Objects
            { level: 1, title: "‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", questions: [
                { word: "red", icon: "üî¥", audio: "red.mp3" },
                { word: "blue", icon: "üîµ", audio: "blue.mp3" },
                { word: "yellow", icon: "üü°", audio: "yellow.mp3" },
                { word: "green", icon: "üü¢", audio: "green.mp3" },
                { word: "sun", icon: "‚òÄÔ∏è", audio: "sun.mp3" },
                { word: "star", icon: "‚≠ê", audio: "star.mp3" },
                { word: "moon", icon: "üåô", audio: "moon.mp3" },
                { word: "cloud", icon: "‚òÅÔ∏è", audio: "cloud.mp3" },
                { word: "tree", icon: "üå≥", audio: "tree.mp3" },
                { word: "flower", icon: "üå∏", audio: "flower.mp3" },
            ]},
            // LEVEL 2: Animals 
            { level: 2, title: "‡∏™‡∏±‡∏ï‡∏ß‡πå", questions: [
                { word: "dog", icon: "üêï", audio: "dog.mp3" },
                { word: "cat", icon: "üêà", audio: "cat.mp3" },
                { word: "fish", icon: "üêü", audio: "fish.mp3" },
                { word: "bird", icon: "üê¶", audio: "bird.mp3" },
                { word: "lion", icon: "ü¶Å", audio: "lion.mp3" },
                { word: "bear", icon: "üêª", audio: "bear.mp3" },
                { word: "cow", icon: "üêÑ", audio: "cow.mp3" },
                { word: "pig", icon: "üêñ", audio: "pig.mp3" },
                { word: "frog", icon: "üê∏", audio: "frog.mp3" },
                { word: "rabbit", icon: "üêá", audio: "rabbit.mp3" },
            ]},
            // LEVEL 3: Fruits 
            { level: 3, title: "‡∏ú‡∏•‡πÑ‡∏°‡πâ", questions: [
                { word: "apple", icon: "üçé", audio: "apple.mp3" },
                { word: "banana", icon: "üçå", audio: "banana.mp3" },
                { word: "grape", icon: "üçá", audio: "grape.mp3" },
                { word: "orange", icon: "üçä", audio: "orange.mp3" },
                { word: "strawberry", icon: "üçì", audio: "strawberry.mp3" },
                { word: "watermelon", icon: "üçâ", audio: "watermelon.mp3" },
                { word: "kiwi", icon: "ü•ù", audio: "kiwi.mp3" },
                { word: "cherry", icon: "üçí", audio: "cherry.mp3" },
                { word: "peach", icon: "üçë", audio: "peach.mp3" },
                { word: "pear", icon: "üçê", audio: "pear.mp3" },
            ]},
             // LEVEL 4: Body Parts
            { level: 4, title: "‡∏≠‡∏ß‡∏±‡∏¢‡∏ß‡∏∞", questions: [
                { word: "head", icon: "üßë", audio: "head.mp3" }, 
                { word: "eye", icon: "üëÅÔ∏è", audio: "eye.mp3" },
                { word: "nose", icon: "üëÉ", audio: "nose.mp3" },
                { word: "mouth", icon: "üëÑ", audio: "mouth.mp3" },
                { word: "ear", icon: "üëÇ", audio: "ear.mp3" },
                { word: "hand", icon: "‚úã", audio: "hand.mp3" },
                { word: "foot", icon: "ü¶∂", audio: "foot.mp3" },
                { word: "arm", icon: "üí™", audio: "arm.mp3" },
                { word: "leg", icon: "ü¶µ", audio: "leg.mp3" },
                { word: "finger", icon: "üëÜ", audio: "finger.mp3" },
            ]},
            // LEVEL 5: Vehicles
            { level: 5, title: "‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞", questions: [
                { word: "car", icon: "üöó", audio: "car.mp3" },
                { word: "bus", icon: "üöå", audio: "bus.mp3" },
                { word: "train", icon: "üöÇ", audio: "train.mp3" },
                { word: "bike", icon: "üö≤", audio: "bike.mp3" },
                { word: "boat", icon: "‚õµ", audio: "boat.mp3" },
                { word: "plane", icon: "‚úàÔ∏è", audio: "plane.mp3" },
                { word: "truck", icon: "üöö", audio: "truck.mp3" },
                { word: "scooter", icon: "üõ¥", audio: "scooter.mp3" },
                { word: "taxi", icon: "üöï", audio: "taxi.mp3" },
                { word: "ship", icon: "üö¢", audio: "ship.mp3" },
            ]},
            // LEVEL 6: Clothes
            { level: 6, title: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤", questions: [
                { word: "shirt", icon: "üëï", audio: "shirt.mp3" },
                { word: "dress", icon: "üëó", audio: "dress.mp3" },
                { word: "shoes", icon: "üëü", audio: "shoes.mp3" },
                { word: "hat", icon: "üß¢", audio: "hat.mp3" },
                { word: "socks", icon: "üß¶", audio: "socks.mp3" },
                { word: "pants", icon: "üëñ", audio: "pants.mp3" },
                { word: "skirt", icon: "üëö", audio: "skirt.mp3" },
                { word: "coat", icon: "üß•", audio: "coat.mp3" },
                { word: "scarf", icon: "üß£", audio: "scarf.mp3" },
                { word: "gloves", icon: "üß§", audio: "gloves.mp3" },
            ]},
            // LEVEL 7: Family
            { level: 7, title: "‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß", questions: [
                { word: "mother", icon: "üë©", audio: "mother.mp3" },
                { word: "father", icon: "üë®", audio: "father.mp3" },
                { word: "sister", icon: "üëß", audio: "sister.mp3" },
                { word: "brother", icon: "üë¶", audio: "brother.mp3" },
                { word: "baby", icon: "üë∂", audio: "baby.mp3" },
                { word: "grandma", icon: "üëµ", audio: "grandma.mp3" },
                { word: "grandpa", icon: "üë¥", audio: "grandpa.mp3" },
                { word: "aunt", icon: "üßë‚Äçü¶±", audio: "aunt.mp3" },
                { word: "uncle", icon: "üßî", audio: "uncle.mp3" },
                { word: "friend", icon: "üßë‚Äçü§ù‚Äçüßë", audio: "friend.mp3" },
            ]},
            // LEVEL 8: Food
            { level: 8, title: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£", questions: [
                { word: "pizza", icon: "üçï", audio: "pizza.mp3" },
                { word: "bread", icon: "üçû", audio: "bread.mp3" },
                { word: "milk", icon: "ü•õ", audio: "milk.mp3" },
                { word: "egg", icon: "ü•ö", audio: "egg.mp3" },
                { word: "cheese", icon: "üßÄ", audio: "cheese.mp3" },
                { word: "carrot", icon: "ü•ï", audio: "carrot.mp3" },
                { word: "soup", icon: "ü•£", "audio": "soup.mp3" },
                { word: "cake", icon: "üéÇ", audio: "cake.mp3" },
                { word: "water", icon: "üíß", audio: "water.mp3" },
                { word: "cookie", icon: "üç™", audio: "cookie.mp3" },
            ]},
            // LEVEL 9: Actions
            { level: 9, title: "‡∏Å‡∏£‡∏¥‡∏¢‡∏≤", questions: [
                { word: "run", icon: "üèÉ", audio: "run.mp3" },
                { word: "jump", icon: "ü§∏", audio: "jump.mp3" },
                { word: "sleep", icon: "üò¥", audio: "sleep.mp3" },
                { word: "eat", icon: "üçΩÔ∏è", audio: "eat.mp3" },
                { word: "drink", icon: "ü•§", audio: "drink.mp3" },
                { word: "read", icon: "üìñ", audio: "read.mp3" },
                { word: "sing", icon: "üé§", audio: "sing.mp3" },
                { word: "walk", icon: "üö∂", audio: "walk.mp3" },
                { word: "play", icon: "ü§π", audio: "play.mp3" },
                { word: "talk", icon: "üó£Ô∏è", audio: "talk.mp3" },
            ]},
            // LEVEL 10: Adjectives
            { level: 10, title: "‡∏Ñ‡∏≥‡∏Ñ‡∏∏‡∏ì‡∏®‡∏±‡∏û‡∏ó‡πå", questions: [
                { word: "happy", icon: "üòÑ", audio: "happy.mp3" },
                { word: "sad", icon: "üò•", audio: "sad.mp3" },
                { word: "big", icon: "‚¨ÜÔ∏è", audio: "big.mp3" },
                { word: "small", icon: "‚¨áÔ∏è", audio: "small.mp3" },
                { word: "hot", icon: "üî•", audio: "hot.mp3" },
                { word: "cold", icon: "ü•∂", audio: "cold.mp3" },
                { word: "fast", icon: "üí®", audio: "fast.mp3" },
                { word: "slow", icon: "üêå", audio: "slow.mp3" },
                { word: "clean", icon: "üßº", audio: "clean.mp3" },
                { word: "dirty", icon: "üí©", audio: "dirty.mp3" },
            ]},
        ];

        const QUESTIONS_PER_LEVEL = 10;
        const OPTIONS_COUNT = 4;

        // --- ELEMENTS ---
        const levelSelectScreen = document.getElementById('level-select-screen');
        const gameScreen = document.getElementById('game-screen');
        const levelGridEl = document.getElementById('level-grid');

        const levelTitleEl = document.getElementById('level-title');
        const qCountEl = document.getElementById('q-count');
        const scoreEl = document.getElementById('score');
        const audioButton = document.getElementById('audio-button');
        const feedbackMessageEl = document.getElementById('feedback-message');
        const optionsArea = document.getElementById('options-area');
        const nextBtn = document.getElementById('next-btn');
        
        const wordAudio = document.getElementById('word-audio');
        const correctAudio = document.getElementById('correct-audio');
        const incorrectAudio = document.getElementById('incorrect-audio');


        // --- GAME STATE ---
        let currentLevelData = null;
        let currentQuizIndex = 0; // 0-9
        let score = 0;
        let isAnswered = false;
        let currentWord = {};

        // --- CORE FUNCTIONS (Audio Fix) ---
        /** 1. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå: ‡πÉ‡∏ä‡πâ Promise ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î */
        function playWordAudio() {
            wordAudio.currentTime = 0;
            const playPromise = wordAudio.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    // ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                }).catch(error => {
                    // ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö)
                    console.warn("Autoplay failed. User must interact (e.g., press the speaker button) to enable audio.");
                    feedbackMessageEl.textContent = 'üîä ‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡∏•‡∏≥‡πÇ‡∏û‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå';
                });
            }
        }

        // --- UI & SCREEN MANAGEMENT ---

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(id).classList.add('active');
        }

        function createLevelButtons() {
            levelGridEl.innerHTML = '';
            ALL_LEVEL_WORDS.forEach(data => {
                const btn = document.createElement('button');
                btn.className = 'level-btn';
                btn.textContent = `Level ${data.level}`;
                
                const titleSpan = document.createElement('span');
                titleSpan.className = 'level-btn-title';
                titleSpan.textContent = data.title;
                
                btn.appendChild(titleSpan);
                btn.setAttribute('data-level', data.level);
                
                btn.addEventListener('click', () => {
                    startLevel(data.level);
                });
                levelGridEl.appendChild(btn);
            });
        }

        function updateStatusBar() {
            if (currentLevelData) {
                levelTitleEl.textContent = `${currentLevelData.title} (Level ${currentLevelData.level})`;
                qCountEl.textContent = `‡∏Ç‡πâ‡∏≠: ${currentQuizIndex + 1}/${currentLevelData.questions.length}`;
            }
            scoreEl.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
        }

        // --- GAME LOGIC ---

        function startLevel(levelId) {
            currentLevelData = ALL_LEVEL_WORDS.find(data => data.level === levelId);
            currentQuizIndex = 0;
            score = 0; 
            showScreen('game-screen');
            nextQuestion();
        }

        function nextQuestion() {
            if (currentQuizIndex >= currentLevelData.questions.length) {
                endGame();
                return;
            }
            
            isAnswered = false;
            nextBtn.textContent = '‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
            nextBtn.disabled = true;
            feedbackMessageEl.textContent = '‡∏Å‡∏î‡∏•‡∏≥‡πÇ‡∏û‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå';
            feedbackMessageEl.style.color = 'var(--color-text-dark)';

            // Reset UI
            optionsArea.innerHTML = ''; 
            
            updateStatusBar();
            setupQuestion();
        }

        /** ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡πÄ‡∏Å‡∏° */
        function getGameOptions() {
            const currentLevelWords = currentLevelData.questions;
            
            // 1. ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å Level ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const correctWord = currentLevelWords[Math.floor(Math.random() * currentLevelWords.length)];
            
            // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 
            let options = [correctWord];
            const allWords = ALL_LEVEL_WORDS.flatMap(l => l.questions);
            const allWordsExcludingCorrect = allWords.filter(w => w.word !== correctWord.word);
            
            // 3. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏•‡∏ß‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 
            const shuffledDistractors = allWordsExcludingCorrect.sort(() => 0.5 - Math.random());
            const distractors = shuffledDistractors.slice(0, OPTIONS_COUNT - 1);
            
            options = [...options, ...distractors];

            while (options.length < OPTIONS_COUNT) {
                options.push(currentLevelWords[Math.floor(Math.random() * currentLevelWords.length)]); 
            }
            
            options.sort(() => Math.random() - 0.5); 
            
            currentWord = correctWord;
            return options.slice(0, OPTIONS_COUNT);
        }


        function setupQuestion() {
            const options = getGameOptions();
            
            // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            options.forEach(item => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.dataset.word = item.word;
                button.dataset.isCorrect = item.word === currentWord.word;
                
                button.innerHTML = `
                    <span class="item-icon">${item.icon}</span>
                    <span class="item-word">${item.word.toUpperCase()}</span>
                `;
                button.addEventListener('click', handleAnswer);
                optionsArea.appendChild(button);
            });

            // 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
            wordAudio.src = `sounds/${currentWord.audio}`;
            wordAudio.load(); 
            
            // 3. ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            setTimeout(() => {
                playWordAudio();
            }, 300);
        }

        function handleAnswer(event) {
            if (isAnswered) return;
            isAnswered = true;
            
            const selectedButton = event.currentTarget;
            const isCorrect = selectedButton.dataset.isCorrect === 'true';

            // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå
            wordAudio.pause();
            wordAudio.currentTime = 0;

            // 1. Disable all choices
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.removeEventListener('click', handleAnswer);
                btn.disabled = true;
            });

            // 2. Feedback
            if (isCorrect) {
                correctAudio.currentTime = 0;
                correctAudio.play();
                score++;
                selectedButton.classList.add('correct');
                feedbackMessageEl.textContent = `‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! (${currentWord.word.toUpperCase()})`;
                feedbackMessageEl.style.color = 'var(--color-correct)';
            } else {
                incorrectAudio.currentTime = 0;
                incorrectAudio.play();
                selectedButton.classList.add('incorrect');
                feedbackMessageEl.textContent = `‚ùå ‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ ${currentWord.word.toUpperCase()}`;
                feedbackMessageEl.style.color = 'var(--color-wrong)';
                
                // Highlight the correct answer
                const correctAnswerButton = document.querySelector(`.option-btn[data-is-correct="true"]`);
                if (correctAnswerButton) {
                    correctAnswerButton.classList.add('correct');
                }
            }
            
            // 3. Update status and enable next button
            updateStatusBar();
            nextBtn.disabled = false;
        }


        function endGame() {
            levelTitleEl.textContent = `‡∏à‡∏ö Level ${currentLevelData.level}!`;
            qCountEl.textContent = '';
            
            const totalQuestions = currentLevelData.questions.length;
            feedbackMessageEl.innerHTML = `
                <span style="font-size:2rem; font-weight:900; color:var(--color-primary);">
                    ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ ${score}/${totalQuestions} ‡∏Ç‡πâ‡∏≠
                </span>
            `;
            feedbackMessageEl.style.color = 'var(--color-primary)';
            
            optionsArea.innerHTML = ''; 

            nextBtn.textContent = '‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å';
            nextBtn.disabled = false;
        }

        // --- EVENT LISTENERS ---
        
        // Speaker button: Replay audio (‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô playWordAudio ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß)
        audioButton.addEventListener('click', () => {
            playWordAudio();
        });

        // Next/Go Back button
        nextBtn.addEventListener('click', () => {
            if (currentQuizIndex >= currentLevelData.questions.length) {
                // Back to Level Selection
                showScreen('level-select-screen');
                currentQuizIndex = 0; 
            } else {
                // Next Question
                currentQuizIndex++;
                nextQuestion();
            }
        });


        // --- INITIAL SETUP ---
        document.addEventListener('DOMContentLoaded', () => {
            createLevelButtons();
            showScreen('level-select-screen');
        });
    </script>
</body>
</html>
